<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Triple Differences Estimators • triplediff</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Triple Differences Estimators">
<meta name="description" content="triplediff implements the triple-differences (DDD) estimators proposed by Ortiz-Villavicencio and Sant’Anna (2025) for both average treatment effects and event-study parameters. It supports staggered treatment timing and multiple pre- and post-periods, with covariate adjustment. Under the hood, triplediff offers regression-adjustment, inverse-probability weighting, and doubly-robust estimators that all rest on a conditional DDD parallel-trends assumption.">
<meta property="og:description" content="triplediff implements the triple-differences (DDD) estimators proposed by Ortiz-Villavicencio and Sant’Anna (2025) for both average treatment effects and event-study parameters. It supports staggered treatment timing and multiple pre- and post-periods, with covariate adjustment. Under the hood, triplediff offers regression-adjustment, inverse-probability weighting, and doubly-robust estimators that all rest on a conditional DDD parallel-trends assumption.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">triplediff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marcelortizv/triplediff"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="triple-differences-estimators-">Triple Differences Estimators <img src="reference/figures/triplediff-logo.png" align="right" alt="" width="155"><a class="anchor" aria-label="anchor" href="#triple-differences-estimators-"></a>
</h1></div>
<p><img src="https://img.shields.io/badge/release%20lifecycle-alpha-orange.svg"><a href="https://github.com/marcelortizv/triplediff" class="external-link"><img src="https://img.shields.io/badge/devel%20version-0.0.0.9000-blue.svg"></a> <a href="https://github.com/marcelortizv/triplediff/commits/main" class="external-link"><img src="https://img.shields.io/github/last-commit/marcelortizv/triplediff.svg"></a> <a href="https://doi.org/10.48550/arXiv.2505.09942" class="external-link"><img src="https://img.shields.io/badge/doi-10.48550/arXiv.2505.09942-yellow.svg"></a></p>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<p><strong>triplediff</strong> is an R package for computing average treatment effects in Triple Differences Designs (also known as Difference-in-Differences-in-Differences or DDD). DDD designs are widely used in empirical work to relax parallel trends assumptions in Difference-in-Differences settings. This package provides functions to estimate group-time average treatment effect and event-study type estimands associated with DDD designs. The setups allowed are:</p>
<ul>
<li>Two-periods or Multiple Periods DDD.</li>
<li>Single Treatment Date and Variation in Treatment Timing (i.e., staggered adoption).</li>
<li>Conditional and Unconditional DDD parallel trends assumptions.</li>
</ul>
<p>The <code>triplediff</code> package implements the framework proposed in:</p>
<ul>
<li><a href="https://arxiv.org/abs/2505.09942" class="external-link">Ortiz-Villavicencio, Marcelo and Pedro H.C. Sant’Anna. “Better Understanding Triple Differences Estimators”, 2025.</a></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the latest <em>development</em> version of <code>triplediff</code> from Github with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"marcelortizv/triplediff"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://marcelortiz.com/triplediff/">triplediff</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start-how-to-use-triplediff">Quick Start: How to use <code>triplediff</code>
<a class="anchor" aria-label="anchor" href="#quick-start-how-to-use-triplediff"></a>
</h2>
<p>We provide a quick start example to illustrate the main features of the package. The UX is designed to be similar to the <code>did</code> package, so users familiar with it should feel comfortable using <code>triplediff</code>.</p>
<p><code>ddd</code> is the main function for computing the DDD estimators proposed in <a href="https://arxiv.org/abs/2505.09942" class="external-link">Ortiz-Villavicencio and Sant’Anna (2025)</a>. At its core, <code>ddd</code> employs regression adjustment, inverse probability weighing, and doubly robust estimators that are valid under conditional DDD parallel trends.</p>
<p>To use <code>ddd</code>, the minimal data requirements include:</p>
<ul>
<li><p><code>id</code>: Unit unique identifier (e.g., firm, individual, etc.). Its column name is associated with parameter <code>idname</code>.</p></li>
<li><p><code>period</code>: Time identifier (e.g., year, month, etc.). Its column name is associated with parameter <code>tname</code>.</p></li>
<li><p><code>outcome</code>: Outcome variable of interest. Its column name is associated with parameter <code>yname</code>.</p></li>
<li><p><code>state</code>: First period when treatment is enabled for a particular unit. It is a positive number for treated units and defines which group the unit belongs to. It takes value <code>0</code> or <code>Inf</code> for never-enabling units. Its column name is associated with parameter <code>gname</code>.</p></li>
<li><p><code>partition</code>: This is an indicator variable that is 1 for the units eligible for treatment and 0 otherwise. Its column name is associated with parameter <code>pname</code>.</p></li>
</ul>
<p>The following are two simplified examples of how to use the <code>ddd</code> function. The first one is for a two-period DDD setup, while the second one is for a multiple-period DDD setup with staggered treatment adoption.</p>
<div class="section level4">
<h4 id="case-two-periods-ddd-with-covariates">Case: Two-Periods DDD with covariates<a class="anchor" aria-label="anchor" href="#case-two-periods-ddd-with-covariates"></a>
</h4>
<p>First, we simulate some data with a built-in function <code>gen_dgp_2periods</code> that generates a two-period DDD setup with a single treatment date. This function receives the number of units and the type of DGP design to generate. The <code>gen_dgp_2periods</code> function returns a data frame with the required columns for the <code>ddd</code> function with 4 covariates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Set seed for reproducibility</span></span>
<span><span class="co"># Simulate data for a two-periods DDD setup</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gen_dgp_2periods.html">gen_dgp_2periods</a></span><span class="op">(</span></span>
<span>  size <span class="op">=</span> <span class="fl">500</span>, <span class="co"># Number of units</span></span>
<span>  dgp_type <span class="op">=</span> <span class="fl">1</span> <span class="co"># Type of DGP design</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;id&gt;</span></span>
<span><span class="co">#&gt;       id state partition  time        y        cov1       cov2        cov3</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;num&gt;     &lt;num&gt; &lt;int&gt;    &lt;num&gt;       &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1     0         0     1 216.3097 -0.97080934  1.3995704  1.48834130</span></span>
<span><span class="co">#&gt; 2:     1     0         0     2 430.9374 -0.97080934  1.3995704  1.48834130</span></span>
<span><span class="co">#&gt; 3:     2     1         0     1 186.5831  0.02591115 -0.9747527  0.01714001</span></span>
<span><span class="co">#&gt; 4:     2     1         0     2 375.9393  0.02591115 -0.9747527  0.01714001</span></span>
<span><span class="co">#&gt; 5:     3     0         1     1 425.6606  0.97147321  0.3310760 -1.51021253</span></span>
<span><span class="co">#&gt; 6:     3     0         1     2 639.5013  0.97147321  0.3310760 -1.51021253</span></span>
<span><span class="co">#&gt;          cov4 cluster</span></span>
<span><span class="co">#&gt;         &lt;num&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  0.3853346      15</span></span>
<span><span class="co">#&gt; 2:  0.3853346      15</span></span>
<span><span class="co">#&gt; 3: -0.7822000      41</span></span>
<span><span class="co">#&gt; 4: -0.7822000      41</span></span>
<span><span class="co">#&gt; 5:  0.2334469       5</span></span>
<span><span class="co">#&gt; 6:  0.2334469       5</span></span></code></pre></div>
<p>Now we can estimate the average treatment effect on the treated (ATT) using the <code>ddd</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate the average treatment effect on the treated, ATT(2,2)</span></span>
<span></span>
<span><span class="va">att_22</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ddd.html">ddd</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"y"</span>, tname <span class="op">=</span> <span class="st">"time"</span>, idname <span class="op">=</span> <span class="st">"id"</span>, gname <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>             pname <span class="op">=</span> <span class="st">"partition"</span>, xformla <span class="op">=</span> <span class="op">~</span><span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span>,</span>
<span>             data <span class="op">=</span> <span class="va">df</span>, control_group <span class="op">=</span> <span class="st">"nevertreated"</span>, est_method <span class="op">=</span> <span class="st">"dr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">att_22</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Call:</span></span>
<span><span class="co">#&gt; ddd(yname = "y", tname = "time", idname = "id", gname = "state", </span></span>
<span><span class="co">#&gt;     pname = "partition", xformla = ~cov1 + cov2 + cov3 + cov4, </span></span>
<span><span class="co">#&gt;     data = df, control_group = "nevertreated", est_method = "dr")</span></span>
<span><span class="co">#&gt; =========================== DDD Summary ==============================</span></span>
<span><span class="co">#&gt;  DR-DDD estimation for the ATT: </span></span>
<span><span class="co">#&gt;      ATT       Std. Error    Pr(&gt;|t|)  [95% Ptwise. Conf. Band]              </span></span>
<span><span class="co">#&gt;      0.0439       0.2626       0.8672      -0.4708       0.5586              </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Note: * indicates that the confidence interval does not contain zero.</span></span>
<span><span class="co">#&gt;  --------------------------- Data Info   -----------------------------</span></span>
<span><span class="co">#&gt;  Panel data</span></span>
<span><span class="co">#&gt;  Outcome variable: y</span></span>
<span><span class="co">#&gt;  Qualification variable: partition</span></span>
<span><span class="co">#&gt;  No. of units at each subgroup:</span></span>
<span><span class="co">#&gt;    treated-and-eligible: 131</span></span>
<span><span class="co">#&gt;    treated-but-ineligible: 133</span></span>
<span><span class="co">#&gt;    eligible-but-untreated: 116</span></span>
<span><span class="co">#&gt;    untreated-and-ineligible: 120</span></span>
<span><span class="co">#&gt;  --------------------------- Algorithms ------------------------------</span></span>
<span><span class="co">#&gt;  Outcome Regression estimated using: OLS</span></span>
<span><span class="co">#&gt;  Propensity score estimated using: Maximum Likelihood</span></span>
<span><span class="co">#&gt;  --------------------------- Std. Errors  ----------------------------</span></span>
<span><span class="co">#&gt;  Level of significance:  0.05</span></span>
<span><span class="co">#&gt;  Analytical standard errors.</span></span>
<span><span class="co">#&gt;  Type of confidence band:  Pointwise Confidence Interval</span></span>
<span><span class="co">#&gt;  =====================================================================</span></span>
<span><span class="co">#&gt;  See Ortiz-Villavicencio and Sant'Anna (2025) for details.</span></span></code></pre></div>
<p>We can also leverage the fact that our estimators are doubly robust to rely on data-driven models for estimating the nuisance parameters. For example, we can use a flexible machine learning like <code>xgboost</code> to estimate outcome models and <code>ranger</code> (Random Forest) to estimate the propensity scores. The engine behind this approach is the <a href="https://mlr3.mlr-org.com/index.html" class="external-link">mlr3</a> package, which provides a unified interface for machine learning in R.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">learner_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, num.trees <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                 min.node.size <span class="op">=</span> <span class="fl">1</span>, importance <span class="op">=</span> <span class="st">'impurity'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learner_regr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.xgboost"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ml_pa <span class="op">=</span> <span class="va">learner_rf</span>, ml_md <span class="op">=</span> <span class="va">learner_regr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">att_22_dml</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ddd.html">ddd</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"y"</span>, tname <span class="op">=</span> <span class="st">"time"</span>, idname <span class="op">=</span> <span class="st">"id"</span>, gname <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                  pname <span class="op">=</span> <span class="st">"partition"</span>, xformla <span class="op">=</span> <span class="op">~</span><span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">df</span>, control_group <span class="op">=</span> <span class="st">"nevertreated"</span>,</span>
<span>                  est_method <span class="op">=</span> <span class="st">"dml"</span>, learners <span class="op">=</span> <span class="va">learners</span>, n_folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.107] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.170] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.191] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 3/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.266] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.455] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.521] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 3/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.625] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.642] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.659] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 3/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.682] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.752] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.824] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 3/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.916] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.933] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.949] [mlr3] Applying learner 'classif.ranger' on task 'pscore_task' (iter 3/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:01.971] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 1/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:02.037] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 2/3)</span></span>
<span><span class="co">#&gt; INFO  [23:42:02.102] [mlr3] Applying learner 'regr.xgboost' on task 'reg_task' (iter 3/3)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">att_22_dml</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Call:</span></span>
<span><span class="co">#&gt; ddd(yname = "y", tname = "time", idname = "id", gname = "state", </span></span>
<span><span class="co">#&gt;     pname = "partition", xformla = ~cov1 + cov2 + cov3 + cov4, </span></span>
<span><span class="co">#&gt;     data = df, control_group = "nevertreated", est_method = "dml", </span></span>
<span><span class="co">#&gt;     learners = learners, n_folds = 3)</span></span>
<span><span class="co">#&gt; =========================== DDD Summary ==============================</span></span>
<span><span class="co">#&gt;  DML-DDD estimation for the ATT: </span></span>
<span><span class="co">#&gt;      ATT       Std. Error    Pr(&gt;|t|)  [95% Ptwise. Conf. Band]              </span></span>
<span><span class="co">#&gt;     -4.3046       2.4784       0.0824      -9.1621       0.5529              </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Note: * indicates that the confidence interval does not contain zero.</span></span>
<span><span class="co">#&gt;  --------------------------- Data Info   -----------------------------</span></span>
<span><span class="co">#&gt;  Panel data</span></span>
<span><span class="co">#&gt;  Outcome variable: y</span></span>
<span><span class="co">#&gt;  Qualification variable: partition</span></span>
<span><span class="co">#&gt;  No. of units at each subgroup:</span></span>
<span><span class="co">#&gt;    treated-and-eligible: 131</span></span>
<span><span class="co">#&gt;    treated-but-ineligible: 133</span></span>
<span><span class="co">#&gt;    eligible-but-untreated: 116</span></span>
<span><span class="co">#&gt;    untreated-and-ineligible: 120</span></span>
<span><span class="co">#&gt;  --------------------------- Algorithms ------------------------------</span></span>
<span><span class="co">#&gt;  Outcome Regression estimated using: Random Forest</span></span>
<span><span class="co">#&gt;  Propensity score estimated using: Extreme Gradient Boosting</span></span>
<span><span class="co">#&gt;  -------------------------- Cross-fitting  ---------------------------</span></span>
<span><span class="co">#&gt;  No. of folds:  3</span></span>
<span><span class="co">#&gt;  Apply cross-fitting: TRUE</span></span>
<span><span class="co">#&gt;  --------------------------- Std. Errors  ----------------------------</span></span>
<span><span class="co">#&gt;  Level of significance:  0.05</span></span>
<span><span class="co">#&gt;  Analytical standard errors.</span></span>
<span><span class="co">#&gt;  Type of confidence band:  Pointwise Confidence Interval</span></span>
<span><span class="co">#&gt;  =====================================================================</span></span>
<span><span class="co">#&gt;  See Ortiz-Villavicencio and Sant'Anna (2025) for details.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="case-multiple-periods-ddd-with-staggered-treatment-adoption">Case: Multiple Periods DDD with staggered treatment adoption<a class="anchor" aria-label="anchor" href="#case-multiple-periods-ddd-with-staggered-treatment-adoption"></a>
</h4>
<p>In this case, we simulate some data with a built-in function <code>gen_dgp_staggered</code> that generates a multiple-period DDD setup with staggered treatment adoption. This function receives the number of units and the type of DGP design to generate. The <code>gen_dgp_staggered</code> function returns a data frame with the required columns for the <code>ddd</code> function with 4 covariates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Set seed for reproducibility</span></span>
<span><span class="co"># Simulate data for a multiple-period DDD setup with staggered treatment adoption</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gen_dgp_mult_periods.html">gen_dgp_mult_periods</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">500</span>, dgp_type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;id&gt;</span></span>
<span><span class="co">#&gt;       id state partition  time         y        cov1       cov2       cov3</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;num&gt;     &lt;num&gt; &lt;int&gt;     &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1     3         1     1 1371.1923 -0.97080934  1.3995704 1.48834130</span></span>
<span><span class="co">#&gt; 2:     1     3         1     2 1690.9157 -0.97080934  1.3995704 1.48834130</span></span>
<span><span class="co">#&gt; 3:     1     3         1     3 2034.5661 -0.97080934  1.3995704 1.48834130</span></span>
<span><span class="co">#&gt; 4:     2     2         1     1  934.0812  0.02591115 -0.9747527 0.01714001</span></span>
<span><span class="co">#&gt; 5:     2     2         1     2 1189.5495  0.02591115 -0.9747527 0.01714001</span></span>
<span><span class="co">#&gt; 6:     2     2         1     3 1444.1072  0.02591115 -0.9747527 0.01714001</span></span>
<span><span class="co">#&gt;          cov4 cluster</span></span>
<span><span class="co">#&gt;         &lt;num&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  0.3853346      27</span></span>
<span><span class="co">#&gt; 2:  0.3853346      27</span></span>
<span><span class="co">#&gt; 3:  0.3853346      27</span></span>
<span><span class="co">#&gt; 4: -0.7822000      45</span></span>
<span><span class="co">#&gt; 5: -0.7822000      45</span></span>
<span><span class="co">#&gt; 6: -0.7822000      45</span></span></code></pre></div>
<p>Now we can estimate the group-time average treatment effect on the treated using the <code>ddd</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate the group-time average treatment effect on the treated, ATT(g,t)</span></span>
<span></span>
<span><span class="va">att_gt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ddd.html">ddd</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"y"</span>, tname <span class="op">=</span> <span class="st">"time"</span>, idname <span class="op">=</span> <span class="st">"id"</span>, gname <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              pname <span class="op">=</span> <span class="st">"partition"</span>, xformla <span class="op">=</span> <span class="op">~</span><span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data</span>, control_group <span class="op">=</span> <span class="st">"nevertreated"</span>, </span>
<span>              base_period <span class="op">=</span> <span class="st">"universal"</span>, est_method <span class="op">=</span> <span class="st">"dr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">att_gt</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Call:</span></span>
<span><span class="co">#&gt; ddd(yname = "y", tname = "time", idname = "id", gname = "state", </span></span>
<span><span class="co">#&gt;     pname = "partition", xformla = ~cov1 + cov2 + cov3 + cov4, </span></span>
<span><span class="co">#&gt;     data = data, control_group = "nevertreated", base_period = "universal", </span></span>
<span><span class="co">#&gt;     est_method = "dr")</span></span>
<span><span class="co">#&gt; =========================== DDD Summary ==============================</span></span>
<span><span class="co">#&gt;  DR-DDD estimation for the ATT(g,t): </span></span>
<span><span class="co">#&gt; Group Time  ATT(g,t)  Std. Error [95% Pointwise  Conf. Band]  </span></span>
<span><span class="co">#&gt;   2    1       0.0000         NA           NA            NA   </span></span>
<span><span class="co">#&gt;   2    2      10.4901     0.3613       9.7819       11.1983  *</span></span>
<span><span class="co">#&gt;   2    3      20.5986     0.3868      19.8405       21.3568  *</span></span>
<span><span class="co">#&gt;   3    1      -0.4593     0.3660      -1.1767        0.2580   </span></span>
<span><span class="co">#&gt;   3    2       0.0000         NA           NA            NA   </span></span>
<span><span class="co">#&gt;   3    3      24.5983     0.3333      23.9450       25.2515  *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Note: * indicates that the confidence interval does not contain zero.</span></span>
<span><span class="co">#&gt;  --------------------------- Data Info   -----------------------------</span></span>
<span><span class="co">#&gt;  Panel data</span></span>
<span><span class="co">#&gt;  Outcome variable: y</span></span>
<span><span class="co">#&gt;  Qualification variable: partition</span></span>
<span><span class="co">#&gt;  Control group: Never Treated</span></span>
<span><span class="co">#&gt;  No. of units per treatment group:</span></span>
<span><span class="co">#&gt;   Units enabling treatment at period 3: 198</span></span>
<span><span class="co">#&gt;   Units enabling treatment at period 2: 195</span></span>
<span><span class="co">#&gt;   Units never enabling treatment: 107</span></span>
<span><span class="co">#&gt;  --------------------------- Algorithms ------------------------------</span></span>
<span><span class="co">#&gt;  Outcome Regression estimated using: OLS</span></span>
<span><span class="co">#&gt;  Propensity score estimated using: Maximum Likelihood</span></span>
<span><span class="co">#&gt;  --------------------------- Std. Errors  ----------------------------</span></span>
<span><span class="co">#&gt;  Level of significance:  0.05</span></span>
<span><span class="co">#&gt;  Analytical standard errors.</span></span>
<span><span class="co">#&gt;  Type of confidence band:  Pointwise Confidence Interval</span></span>
<span><span class="co">#&gt;  =====================================================================</span></span>
<span><span class="co">#&gt;  See Ortiz-Villavicencio and Sant'Anna (2025) for details.</span></span></code></pre></div>
<p>Next, we can aggregate the group-time average treatment effect on the treated to obtain the event-study type estimates. The <code>agg_ddd</code> function allows us to aggregate the results from the <code>ddd</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/agg_ddd.html">agg_ddd</a></span><span class="op">(</span><span class="va">att_gt</span>, type <span class="op">=</span> <span class="st">"eventstudy"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">es_e</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Call:</span></span>
<span><span class="co">#&gt; agg_ddd(ddd_obj = att_gt, type = "eventstudy")</span></span>
<span><span class="co">#&gt; ========================= DDD Aggregation ============================</span></span>
<span><span class="co">#&gt;  Overall summary of ATT's based on event-study/dynamic aggregation: </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  19.0983        0.3213    18.4685     19.7281 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Event Study:</span></span>
<span><span class="co">#&gt;  Event time Estimate Std. Error [95% Ptwise.  Conf. Band]  </span></span>
<span><span class="co">#&gt;          -2  -0.4593     0.3660       -1.1767      0.2580  </span></span>
<span><span class="co">#&gt;          -1   0.0000         NA            NA          NA  </span></span>
<span><span class="co">#&gt;           0  17.5980     0.4095       16.7955     18.4005 *</span></span>
<span><span class="co">#&gt;           1  20.5986     0.3868       19.8405     21.3568 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Note: * indicates that the confidence interval does not contain zero.</span></span>
<span><span class="co">#&gt;  --------------------------- Data Info   -----------------------------</span></span>
<span><span class="co">#&gt;  Outcome variable: y</span></span>
<span><span class="co">#&gt;  Partition variable: partition</span></span>
<span><span class="co">#&gt;  Control group:  Never Treated</span></span>
<span><span class="co">#&gt;  --------------------------- Std. Errors  ----------------------------</span></span>
<span><span class="co">#&gt;  Level of significance:  0.05</span></span>
<span><span class="co">#&gt;  Analytical standard errors.</span></span>
<span><span class="co">#&gt;  =====================================================================</span></span>
<span><span class="co">#&gt;  See Ortiz-Villavicencio and Sant'Anna (2025) for details.</span></span></code></pre></div>
<p>From these event-study type estimates, we can plot the results using the <code>ggplot</code> library to create crisp visualizations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">es_e</span><span class="op">$</span><span class="va">aggte_ddd</span>, <span class="op">{</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>period   <span class="op">=</span> <span class="va">egt</span>,</span>
<span>                   estimate <span class="op">=</span> <span class="va">att.egt</span>,</span>
<span>                   ci_lower <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="va">crit.val.egt</span> <span class="op">*</span> <span class="va">se.egt</span>,</span>
<span>                   ci_upper <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="va">crit.val.egt</span> <span class="op">*</span> <span class="va">se.egt</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">all_per</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">es_df</span><span class="op">$</span><span class="va">period</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">es_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">period</span>, <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>,</span>
<span>                  width <span class="op">=</span> <span class="fl">.15</span>,</span>
<span>                  position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.2</span>,</span>
<span>               position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               linewidth <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_continuous</span><span class="op">(</span></span>
<span>      breaks <span class="op">=</span> <span class="va">all_per</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Event Time"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Treatment Effect"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title   <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png"><!-- --></p>
<p>Finally, we can also estimate the group-time average treatment effect on the treated using a GMM-based estimator with not-yet-treated units as comparison group. This is done by setting the <code>control_group</code> parameter to <code>"notyettreated"</code> in the <code>ddd</code> function.</p>
<ul>
<li>⚠️ We recommend users to read our paper for more details on the GMM-based procedure and its difference with other estimators relying in not-yet-treated units as comparison group.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do the same but using GMM-based notyettreated</span></span>
<span><span class="va">att_gt_nyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ddd.html">ddd</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"y"</span>, tname <span class="op">=</span> <span class="st">"time"</span>, idname <span class="op">=</span> <span class="st">"id"</span>, gname <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              pname <span class="op">=</span> <span class="st">"partition"</span>, xformla <span class="op">=</span> <span class="op">~</span><span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data</span>, control_group <span class="op">=</span> <span class="st">"notyettreated"</span>, </span>
<span>              base_period <span class="op">=</span> <span class="st">"universal"</span>, est_method <span class="op">=</span> <span class="st">"dr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">att_gt_nyt</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Call:</span></span>
<span><span class="co">#&gt; ddd(yname = "y", tname = "time", idname = "id", gname = "state", </span></span>
<span><span class="co">#&gt;     pname = "partition", xformla = ~cov1 + cov2 + cov3 + cov4, </span></span>
<span><span class="co">#&gt;     data = data, control_group = "notyettreated", base_period = "universal", </span></span>
<span><span class="co">#&gt;     est_method = "dr")</span></span>
<span><span class="co">#&gt; =========================== DDD Summary ==============================</span></span>
<span><span class="co">#&gt;  DR-DDD estimation for the ATT(g,t): </span></span>
<span><span class="co">#&gt; Group Time  ATT(g,t)  Std. Error [95% Pointwise  Conf. Band]  </span></span>
<span><span class="co">#&gt;   2    1       0.0000         NA           NA            NA   </span></span>
<span><span class="co">#&gt;   2    2      10.1894     0.2759       9.6486       10.7302  *</span></span>
<span><span class="co">#&gt;   2    3      20.5986     0.3868      19.8405       21.3568  *</span></span>
<span><span class="co">#&gt;   3    1      -0.4593     0.3660      -1.1767        0.2580   </span></span>
<span><span class="co">#&gt;   3    2       0.0000         NA           NA            NA   </span></span>
<span><span class="co">#&gt;   3    3      24.5983     0.3333      23.9450       25.2515  *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Note: * indicates that the confidence interval does not contain zero.</span></span>
<span><span class="co">#&gt;  --------------------------- Data Info   -----------------------------</span></span>
<span><span class="co">#&gt;  Panel data</span></span>
<span><span class="co">#&gt;  Outcome variable: y</span></span>
<span><span class="co">#&gt;  Qualification variable: partition</span></span>
<span><span class="co">#&gt;  Control group: Not yet Treated</span></span>
<span><span class="co">#&gt;  No. of units per treatment group:</span></span>
<span><span class="co">#&gt;   Units enabling treatment at period 3: 198</span></span>
<span><span class="co">#&gt;   Units enabling treatment at period 2: 195</span></span>
<span><span class="co">#&gt;   Units never enabling treatment: 107</span></span>
<span><span class="co">#&gt;  --------------------------- Algorithms ------------------------------</span></span>
<span><span class="co">#&gt;  Outcome Regression estimated using: OLS</span></span>
<span><span class="co">#&gt;  Propensity score estimated using: Maximum Likelihood</span></span>
<span><span class="co">#&gt;  --------------------------- Std. Errors  ----------------------------</span></span>
<span><span class="co">#&gt;  Level of significance:  0.05</span></span>
<span><span class="co">#&gt;  Analytical standard errors.</span></span>
<span><span class="co">#&gt;  Type of confidence band:  Pointwise Confidence Interval</span></span>
<span><span class="co">#&gt;  =====================================================================</span></span>
<span><span class="co">#&gt;  See Ortiz-Villavicencio and Sant'Anna (2025) for details.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="release-note-">Release Note 📢<a class="anchor" aria-label="anchor" href="#release-note-"></a>
</h2>
<p>The current version is released in an <strong>alpha</strong> stage: the core features are implemented and made available so users can try them out and provide feedback. Please, be aware that it remains under active development, so long-term stability is not guaranteed—APIs may evolve, adding more features and/or breaking changes can occur at any time, without a deprecation cycle.</p>
<p>Use <a href="https://github.com/marcelortizv/triplediff/issues" class="external-link">GitHub Issues</a> to report bugs, request features or provide feedback.</p>
<div class="section level3">
<h3 id="id_-currently-supported">🚀 Currently Supported<a class="anchor" aria-label="anchor" href="#id_-currently-supported"></a>
</h3>
<ul>
<li>️✅ Two-periods with single treatment date.</li>
<li>️✅ Multiple periods with single treatment date.</li>
<li>️✅ Staggered treatment adoption (i.e., more than two periods and variation in treatment timing).</li>
<li>️✅ Aggregations procedures (e.g., event-study type estimates).</li>
<li>️✅ GMM-based estimations with not-yet-treated units as comparison group.</li>
</ul>
</div>
<div class="section level3">
<h3 id="id_️-not-yet-supported">⚠️ Not Yet Supported<a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-not-yet-supported"></a>
</h3>
<ul>
<li>🔲 User-specified data-driven models for estimations of nuisance parameters.
<ul>
<li>This is partially implemented via the <code>mlr3</code> package, which provides a unified interface for off-the-shelf ML algorithms in R. Users can specify their own models for estimating outcome models and propensity scores. Currently, two-period DDD with single treatment date is the only setting supported.</li>
</ul>
</li>
<li>🔲 Built-in plotting capabilities for visualizing results.
<ul>
<li>This can be done easily by users. E.g., event-study type estimates can be plotted using <code>ggplot2</code>. See the quick start example.</li>
</ul>
</li>
<li>🔲 Repeated cross-sectional data.</li>
<li>🔲 Unbalanced panel data.</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/marcelortizv/triplediff" class="external-link">Source Code</a></li>
<li><a href="https://github.com/marcelortizv/triplediff/issues" class="external-link">Report Bugs or Feature Requests</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing triplediff</a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://marcelortiz.com/" class="external-link">Marcelo Ortiz-Villavicencio</a>, <a href="https://psantanna.com/" class="external-link">Pedro H. C. Sant’Anna</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
